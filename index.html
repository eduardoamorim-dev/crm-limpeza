<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CRM Limpeza - Cadastro de Pessoas</title>
    <style>
      /* Estilo global */
      body {
        font-family: "Arial", sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f0f0f0;
      }

      /* Container principal */
      .container {
        max-width: 800px;
        margin: 20px auto;
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }

      /* Título centralizado */
      .centered-title {
        text-align: center;
        margin-bottom: 20px;
        font-size: 1.8em;
        color: #333;
      }

      /* Formulário de cadastro */
      .form-cadastro {
        margin-bottom: 20px;
      }

      .form-cadastro h3 {
        font-size: 1.2em;
        margin-bottom: 10px;
        color: #333;
      }

      .form-cadastro label {
        display: block;
        margin-top: 15px;
        font-size: 1.1em;
        color: #333;
      }

      .form-cadastro input,
      .form-cadastro select {
        margin-bottom: 15px;
        width: 100%;
        padding: 10px;
        font-size: 1em;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
      }

      .form-cadastro .grupo-container {
        display: flex;
        align-items: center;
      }

      .form-cadastro #novoGrupo {
        margin-right: 10px;
        flex: 1;
      }

      .form-cadastro button {
        padding: 12px 24px;
        margin-right: 10px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      .form-cadastro button:hover {
        background-color: #0056b3;
      }

      .form-cadastro button.cadastrar {
        background-color: #28a745; /* Verde */
      }

      .form-cadastro button.baixarPDF {
        background-color: #28a745; /* Verde */
      }

      .form-cadastro button.remover {
        background-color: #dc3545; /* Vermelho */
        margin-left: 10px;
        margin-bottom: 15px;
      }

      /* Estilização adicional */
      hr {
        border-top: 1px solid #ccc;
        margin: 20px 0;
      }

      .grupo-lista {
        margin-bottom: 20px;
      }

      .grupo-lista h2 {
        font-size: 1.5em;
        margin-bottom: 10px;
        color: #333;
      }

      .grupo-lista .grupo-item {
        margin-bottom: 20px;
        padding: 10px;
        background-color: #f8f9fa;
        border: 1px solid #ccc;
        border-radius: 4px;
      }

      .grupo-lista .grupo-item h3 {
        margin-bottom: 10px;
        color: #333;
      }

      .grupo-lista .pessoa-item {
        margin-bottom: 10px;
        padding: 5px 10px;
        background-color: #fff;
        border: 1px solid #ccc;
        border-radius: 4px;
      }

      .grupo-lista .pessoa-item p {
        margin: 5px 0;
      }

      .acoes {
        margin-top: 20px;
      }

      .acoes button {
        margin-right: 10px;
        padding: 10px 20px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        transition: background-color 0.3s;
      }

      .acoes button:hover {
        background-color: #0056b3;
      }

      .acoes button.remover {
        background-color: #dc3545; /* Vermelho */
      }

      .acoes button.baixarPDF {
        background-color: #28a745; /* Verde */
      }

      /* Responsividade */
      @media (max-width: 768px) {
        .form-cadastro input,
        .form-cadastro select {
          width: 100%;
        }

        .form-cadastro button,
        .acoes button {
          width: 100%;
          margin-bottom: 10px;
        }

        .form-cadastro .grupo-container {
          flex-direction: column;
          align-items: flex-start;
        }

        .form-cadastro #novoGrupo {
          margin-right: 0;
          margin-bottom: 10px;
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Tela de Cadastro -->
      <div id="cadastro">
        <h1 class="centered-title">CRM Limpeza - Cadastro de Pessoas</h1>
        <hr />
        <form id="formCadastro" class="form-cadastro">
          <div class="form-section">
            <h3>Nome</h3>
            <input type="text" id="nome" name="nome" required />
          </div>

          <div class="form-section">
            <h3>Selecionar um grupo</h3>
            <div class="grupo-container">
              <select id="grupo" name="grupo"></select>
              <button type="button" onclick="removerGrupo()" class="remover">
                Remover Grupo
              </button>
            </div>
          </div>

          <hr />

          <div class="acoes">
            <button type="button" onclick="cadastrarPessoa()" class="cadastrar">
              Cadastrar
            </button>
            <button type="button" onclick="mostrarVisualizacao()">
              Visualizar
            </button>
          </div>

          <hr />

          <div class="form-section">
            <h3>Adicionar um novo grupo</h3>
            <div class="grupo-container">
              <input type="text" id="novoGrupo" placeholder="Novo Grupo" />
            </div>
          </div>

          <div class="form-section">
            <h3>Data de Limpeza</h3>
            <input
              type="number"
              id="diaGrupo"
              name="diaGrupo"
              min="1"
              max="31"
              placeholder="Dia"
              required
            />
            <input
              type="number"
              id="mesGrupo"
              name="mesGrupo"
              min="1"
              max="12"
              placeholder="Mês"
              required
            />
            <input
              type="number"
              id="anoGrupo"
              name="anoGrupo"
              min="1900"
              max="2100"
              placeholder="Ano"
              required
            />
          </div>

          <hr />

          <button type="button" onclick="adicionarNovoGrupo()">
            Adicionar Grupo
          </button>
        </form>
      </div>

      <!-- Tela de Visualização -->
      <div id="visualizacao" style="display: none">
        <h1 class="centered-title">
          CRM Limpeza - Visualização de Pessoas Cadastradas
        </h1>
        <div id="listaGrupos" class="grupo-lista"></div>
        <hr />
        <div class="acoes">
          <button
            type="button"
            class="remover"
            onClick="removerTodasAsPessoasDosGrupos()"
          >
            Remover Todas as Pessoas dos Grupos
          </button>
          <button onclick="mostrarCadastro()">Voltar ao Cadastro</button>
          <button onclick="baixarPDF()" class="baixarPDF">Baixar PDF</button>
        </div>
      </div>
    </div>

    <!-- Script do PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Script JavaScript -->
    <script>
      let grupos = [];

      // Função para salvar dados no localStorage
      function salvarDadosLocalStorage() {
        localStorage.setItem("grupos", JSON.stringify(grupos));
      }

      // Função para carregar dados do localStorage
      function carregarDadosLocalStorage() {
        const gruposLocalStorage = localStorage.getItem("grupos");
        if (gruposLocalStorage) {
          grupos = JSON.parse(gruposLocalStorage);
          atualizarSelectGrupos();
          atualizarListaGrupos();
        }
      }

      function adicionarNovoGrupo() {
        const novoGrupo = document.getElementById("novoGrupo").value.trim();
        const dia = document.getElementById("diaGrupo").value;
        const mes = document.getElementById("mesGrupo").value;
        const ano = document.getElementById("anoGrupo").value;

        if (novoGrupo !== "") {
          grupos.push({
            nome: novoGrupo,
            data: `${dia}/${mes}/${ano}`,
            pessoas: [],
          });
          document.getElementById("novoGrupo").value = "";
          document.getElementById("diaGrupo").value = "";
          document.getElementById("mesGrupo").value = "";
          document.getElementById("anoGrupo").value = "";
          atualizarSelectGrupos();
          salvarDadosLocalStorage();
        }
      }

      function atualizarSelectGrupos() {
        const selectGrupo = document.getElementById("grupo");
        selectGrupo.innerHTML = "";

        grupos.forEach((grupo) => {
          const option = document.createElement("option");
          option.value = grupo.nome;
          option.textContent = `${grupo.nome} - ${grupo.data}`;
          selectGrupo.appendChild(option);
        });
      }

      function cadastrarPessoa() {
        const nome = document.getElementById("nome").value.trim();
        const grupoNome = document.getElementById("grupo").value;

        if (nome === "" || grupoNome === "") {
          alert("Por favor, preencha todos os campos.");
          return;
        }

        const grupo = grupos.find((g) => g.nome === grupoNome);
        if (grupo) {
          grupo.pessoas.push({ nome });
          document.getElementById("nome").value = "";
          salvarDadosLocalStorage();
          alert(`Cadastro realizado com sucesso.`);
        }
      }

      function atualizarListaGrupos() {
        const listaGrupos = document.getElementById("listaGrupos");
        listaGrupos.innerHTML = "";

        grupos.forEach((grupo) => {
          const grupoItem = document.createElement("div");
          grupoItem.className = "grupo-item";

          const grupoTitulo = document.createElement("h3");
          grupoTitulo.textContent = `${grupo.nome} - ${grupo.data}`;
          grupoItem.appendChild(grupoTitulo);

          if (grupo.pessoas.length === 0) {
            const nenhumaPessoa = document.createElement("p");
            nenhumaPessoa.textContent =
              "Nenhuma pessoa cadastrada nesse grupo.";
            grupoItem.appendChild(nenhumaPessoa);
          } else {
            grupo.pessoas.forEach((pessoa, index) => {
              const pessoaItem = document.createElement("div");
              pessoaItem.className = "pessoa-item";

              const pessoaNome = document.createElement("p");
              pessoaNome.textContent = `Nome: ${pessoa.nome}`;
              pessoaItem.appendChild(pessoaNome);

              const selectGrupos = document.createElement("select");
              grupos.forEach((grupo) => {
                const option = document.createElement("option");
                option.value = grupo.nome;
                option.textContent = `${grupo.nome} - ${grupo.data}`;
                selectGrupos.appendChild(option);
              });
              pessoaItem.appendChild(selectGrupos);

              const moverButton = document.createElement("button");
              moverButton.textContent = "Mover";
              moverButton.addEventListener("click", () => {
                const novoGrupoNome = selectGrupos.value;
                moverPessoaParaOutroGrupo(grupo.nome, index, novoGrupoNome);
              });
              pessoaItem.appendChild(moverButton);

              const removerButton = document.createElement("button");
              removerButton.textContent = "Remover";
              removerButton.addEventListener("click", () => {
                grupo.pessoas.splice(index, 1);
                salvarDadosLocalStorage();
                atualizarListaGrupos();
              });
              pessoaItem.appendChild(removerButton);

              grupoItem.appendChild(pessoaItem);
            });
          }

          listaGrupos.appendChild(grupoItem);
        });
      }

      function mostrarCadastro() {
        document.getElementById("cadastro").style.display = "block";
        document.getElementById("visualizacao").style.display = "none";
      }

      function mostrarVisualizacao() {
        document.getElementById("cadastro").style.display = "none";
        document.getElementById("visualizacao").style.display = "block";
        atualizarListaGrupos();
      }

      function removerTodasAsPessoasDosGrupos() {
        grupos.forEach((grupo) => {
          grupo.pessoas = [];
        });
        salvarDadosLocalStorage();
        atualizarListaGrupos();
      }

      function baixarPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        let yPosition = 10;

        doc.setFont(undefined, "bold");
        doc.setFontSize(16);
        doc.text("CRM Limpeza - Lista de Pessoas Cadastradas", 10, yPosition);
        yPosition += 10;

        grupos.forEach((grupo, grupoIndex) => {

          if (yPosition > 280) {
            doc.addPage();
            yPosition = 10;
          }

          doc.setFont(undefined, "bold");
          doc.setFontSize(14);
          doc.text(
            `${grupoIndex + 1}. ${grupo.nome} - Data: ${grupo.data}`,
            10,
            yPosition
          );
          yPosition += 10;

          doc.setFont(undefined, "normal");
          doc.setFontSize(12);
          if (grupo.pessoas.length === 0) {
            doc.text(
              "   Nenhuma pessoa cadastrada nesse grupo.",
              10,
              yPosition
            );
            yPosition += 10;
          } else {
            grupo.pessoas.forEach((pessoa, pessoaIndex) => {

              if (yPosition > 280) {
                doc.addPage();
                yPosition = 10;
              }
              doc.text(
                `   ${pessoaIndex + 1}. Nome: ${pessoa.nome}`,
                10,
                yPosition
              );
              yPosition += 10;
            });
          }

          yPosition += 5; 
        });

        doc.save("CRM_Limpeza_Lista_de_Pessoas_Cadastradas.pdf");
      }

      function removerGrupo() {
        const grupoNome = document.getElementById("grupo").value;
        if (grupoNome) {
          grupos = grupos.filter((g) => g.nome !== grupoNome);
          atualizarSelectGrupos();
          salvarDadosLocalStorage();
        }
      }

      function moverPessoaParaOutroGrupo(
        grupoAtualNome,
        pessoaIndex,
        novoGrupoNome
      ) {
        const grupoAtual = grupos.find((g) => g.nome === grupoAtualNome);
        const novoGrupo = grupos.find((g) => g.nome === novoGrupoNome);

        if (grupoAtual && novoGrupo) {
          const pessoa = grupoAtual.pessoas.splice(pessoaIndex, 1)[0];
          novoGrupo.pessoas.push(pessoa);
          salvarDadosLocalStorage();
          atualizarListaGrupos();
        }
      }

      document.addEventListener("DOMContentLoaded", carregarDadosLocalStorage);
    </script>
  </body>
</html>
